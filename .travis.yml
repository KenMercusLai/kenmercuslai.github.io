language: go
branches:
  only:
    - source
    - content
github_token: $GITHUB_TOKEN
addons:
  apt:
    packages:
    - hugo
before_install:
  # - sudo a# pt-get update
#   - sudo apt-get -y install hugo
#   - sleep10
  - git clone --single-branch --branch source https://github.com/KenMercusLai/kenmercuslai.github.io.git source
  - cd source
  - git clone --single-branch --branch content https://github.com/KenMercusLai/kenmercuslai.github.io.git content
script:
  - hugo -D
after_success:
  - cd public
  - echo "kenmlai.me" > CNAME
  - git init
  - git config user.name "KenMercusLai"
  - git config user.email "ken.mercus.lai@gmail.com"
  - git add .
  - git commit -m "$(date)"
  - git remote add origin https://${GITHUB_TOKEN}@github.com/KenMercusLai/kenmercuslai.github.io.git
  - git remote -v
  - git push origin master -f
notifications:
  email:
    recipients:
      - ken.mercus.lai@gmail.com
    on_success: never
    on_failure: always
