---
date: 201910311448
---
# Docker Tips

1. Any edit in a Dockerfile will cause re-builds of consequential steps, so put lines that rarely changes in front
2. Avoid using `COPY .` to copy a whole folder, only copy files are needed to avoid rebuild when any file changes in the folder
3. Too many RUN commands increase layers. Try to combine set steps into one.
4. Don't install any development/debug tools/packages for production, only install everything that is needed. like using `--no-install-recommends` with `apt`
5. remove package cache
6. use official images when possible: using python3.7 instead of ubuntu when the image is for a python app.
7. use more specific tags, which show the version explicitly; also specify the minimal image when possible, install everything manually
8. build from source in a consistent environment (use docker to build)
9. fetch & install dependencies in a separate step
10. use multi-stage builds to remove build dependencies (point 8 & 9)


Ref: [^E907E61F56B1]

11. docker images can be manually moved to another host if both public and private registries aren't able to be used. [^A8B1096CDFBC] [^CBB6CAE1E29E]

on source

```bash
docker save myimage:latest | gzip > myimage_latest.tar.gz
```

on destination

```bash
docker load < myimage_latest.tar.gz
```


12. Remove containers. containers can be removed automatically if `--rm` is used with `docker run`, we can use the follow command to erase them[^A6E28E850280].

```bash
docker container prune
```

we can stop and erase all containers as well

```bash
docker container stop $(docker container ls -aq)
docker container rm $(docker container ls -aq)
```

13. Get IP address of a container.[^276995009D05]

Modern Docker

```bash
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' container_name_or_id
```

Old Docker

```bash
docker inspect --format '{{ .NetworkSettings.IPAddress }}' container_name_or_id
```

customized function for shell[^1]

Pop this into your ~/.bashrc (Linux) or ~/.bash_profile (Mac) 

```bash
dockip() { 
  docker inspect --format '{{ .NetworkSettings.IPAddress }}' "$@" } 
```


[^276995009D05]: [[How to get a Docker container's IP address from the host? - Stack Overflow]]

[^A6E28E850280]: [[小贴士：Docker清理作弊手册]]

[^A8B1096CDFBC]: [[docker save | Docker Documentation]]

[^CBB6CAE1E29E]: [[docker load | Docker Documentation]]

[^E907E61F56B1]: [[你确定你会写 Dockerfile 吗？ - 米开朗基杨的博客]]

[^1]: [10 Examples of how to get Docker Container IP Address](x-devonthink-item://ED4787F7-CB1C-4BE5-946E-24C928CA554E?page=1)

